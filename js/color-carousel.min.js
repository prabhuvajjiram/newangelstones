(function($){'use strict';let colors=[];let currentColorIndex=0;function initColorCarousel(){fetchColorImages().then(()=>{populateColorDisplay();setupEventListeners();}).catch(error=>{console.error('Error initializing color carousel:',error);});}function fetchColorImages(){return new Promise((resolve,reject)=>{$.ajax({url:'get_color_images.php',dataType:'json',success:function(data){if(data&&data.colors&&data.colors.length>0){colors=data.colors;resolve();}else{reject('No color images found');}},error:function(xhr,status,error){console.error('Error fetching color images:',error);reject(error);}});});}function populateColorDisplay(){const $container=$('#variety-of-granites .owl-carousel');$container.removeClass('owl-carousel owl-theme');$container.empty();$container.addClass('color-scroll-container');colors.forEach((color,index)=>{const item=`<div class="color-scroll-item" data-index="${index}"><div class="color-scroll-image"><img src="${color.path}" loading="lazy" width="220" height="220" class="img-fluid" alt="${color.name}" onerror="this.onerror=null; this.src='images/placeholder.jpg';"></div><div class="caption"><p>${color.name}</p></div></div>`;$container.append(item);});if($container.data('owl.carousel')){$container.trigger('destroy.owl.carousel');}const $carouselContainer=$container.closest('.col-md-12');if($carouselContainer.find('.view-all-colors-btn').length===0){$carouselContainer.append(`<div class="text-center mt-4"><button class="btn view-all-colors-btn">View All Colors</button></div>`);}}function setupEventListeners(){$(document).on('click','.view-all-colors-btn',function(e){e.preventDefault();showAllColorsModal();});$(document).on('click','.color-scroll-item',function(e){const index=$(this).data('index');showColorFullscreen(index);});$(document).on('click','.color-grid-item',function(e){const index=$(this).data('index');showColorFullscreen(index);});$(document).on('click','.color-fullscreen-nav',function(e){e.stopPropagation();if($(this).hasClass('color-fullscreen-prev')){navigateColors('prev');}else{navigateColors('next');}});$(document).on('click','.color-fullscreen-container',function(e){if(e.target===this){closeColorFullscreen();}});$(document).on('click','.color-fullscreen-close',function(e){e.stopPropagation();closeColorFullscreen();});$(document).on('keydown',function(e){if($('.color-fullscreen-container').is(':visible')){if(e.key==='Escape'){closeColorFullscreen();}else if(e.key==='ArrowLeft'){navigateColors('prev');}else if(e.key==='ArrowRight'){navigateColors('next');}}});let touchStartX=0;let touchEndX=0;$(document).on('touchstart','.color-fullscreen-container',function(e){touchStartX=e.originalEvent.touches[0].clientX;});$(document).on('touchend','.color-fullscreen-container',function(e){touchEndX=e.originalEvent.changedTouches[0].clientX;handleSwipe();});function handleSwipe(){const threshold=50;if(touchEndX<touchStartX-threshold){navigateColors('next');}else if(touchEndX>touchStartX+threshold){navigateColors('prev');}}$('.color-scroll-container').on('mouseenter',function(){if(this.scrollWidth>this.clientWidth){$(this).addClass('scrollable-hint');setTimeout(()=>{$(this).removeClass('scrollable-hint');},1500);}});}function showAllColorsModal(){$('#allColorsModal').remove();let modalHtml=`<div class="modal fade" id="allColorsModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">All Colors</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="color-grid">`;colors.forEach((color,index)=>{modalHtml+=`<div class="color-grid-item" data-index="${index}"><div class="color-image"><img src="${color.path}" width="160" height="160" loading="lazy" alt="${color.name}" onerror="this.onerror=null; this.src='images/placeholder.jpg';"></div><div class="color-name">${color.name}</div></div>`;});modalHtml+=`</div></div></div></div></div>`;$('body').append(modalHtml);const modal=new bootstrap.Modal(document.getElementById('allColorsModal'));modal.show();}function showColorFullscreen(index){currentColorIndex=index;const color=colors[index];$('.color-fullscreen-container').remove();const fullscreenHtml=`<div class="color-fullscreen-container"><div class="color-fullscreen-content"><img src="${color.path}" alt="${color.name}" class="color-fullscreen-image" onerror="this.onerror=null; this.src='images/placeholder.jpg';"><div class="color-fullscreen-caption">${color.name}</div><button class="color-fullscreen-nav color-fullscreen-prev"><i class="bi bi-chevron-left"></i></button><button class="color-fullscreen-nav color-fullscreen-next"><i class="bi bi-chevron-right"></i></button><button class="color-fullscreen-close"><i class="bi bi-x"></i></button></div></div>`;$('body').append(fullscreenHtml);$('body').addClass('overflow-hidden');const modal=bootstrap.Modal.getInstance(document.getElementById('allColorsModal'));if(modal){modal.hide();}}function closeColorFullscreen(){$('.color-fullscreen-container').remove();$('body').removeClass('overflow-hidden');if($('#allColorsModal').length){const modal=new bootstrap.Modal(document.getElementById('allColorsModal'));modal.show();}}function navigateColors(direction){if(direction==='prev'){currentColorIndex=(currentColorIndex-1+colors.length)%colors.length;}else{currentColorIndex=(currentColorIndex+1)%colors.length;}const color=colors[currentColorIndex];$('.color-fullscreen-image').attr('src',color.path).attr('alt',color.name).on('error',function(){$(this).attr('src','images/placeholder.jpg');});$('.color-fullscreen-caption').text(color.name);}$(document).ready(function(){initColorCarousel();});})(jQuery);
